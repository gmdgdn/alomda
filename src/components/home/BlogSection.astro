---
import { getCollection } from "astro:content";
import Container from "../ui/Container.astro";
import { Calendar, ArrowLeft } from "lucide-react";
import { Image } from "astro:assets";

const posts = await getCollection("blog");
const latestPosts = posts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 3);
---

<section class="py-24 bg-white">
    <Container>
        <div class="flex items-end justify-between mb-12">
            <div class="max-w-2xl">
                <span
                    class="text-emerald-600 font-bold text-sm tracking-wider uppercase mb-2 block"
                >
                    المدونة
                </span>
                <h2 class="text-4xl font-bold text-slate-900">
                    أحدث المقالات والنصائح
                </h2>
            </div>
            <a
                href="/blog"
                class="hidden md:flex items-center gap-2 text-emerald-600 font-bold hover:text-emerald-700 transition-colors"
            >
                عرض جميع المقالات
                <ArrowLeft className="w-5 h-5" />
            </a>
        </div>

        <div class="grid md:grid-cols-3 gap-8">
            {
                latestPosts.map((post) => (
                    <a
                        href={`/blog/${post.slug}`}
                        class="group flex flex-col bg-slate-50 rounded-3xl overflow-hidden border border-slate-100 hover:shadow-xl transition-all duration-300 hover:-translate-y-1"
                    >
                        <div class="relative h-56 overflow-hidden bg-slate-100">
                            {post.data.image && (
                                <Image
                                    src={post.data.image}
                                    alt={post.data.title}
                                    width={600}
                                    height={400}
                                    class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                />
                            )}
                            <div class="absolute inset-0 bg-gradient-to-t from-slate-900/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                        </div>

                        <div class="p-6 flex flex-col flex-grow">
                            <div class="flex items-center gap-2 text-slate-500 text-sm mb-4">
                                <Calendar className="w-4 h-4" />
                                <time
                                    datetime={post.data.pubDate.toISOString()}
                                >
                                    {post.data.pubDate.toLocaleDateString(
                                        "ar-SA",
                                        {
                                            year: "numeric",
                                            month: "long",
                                            day: "numeric",
                                        },
                                    )}
                                </time>
                            </div>

                            <h3 class="text-xl font-bold text-slate-900 mb-3 line-clamp-2 group-hover:text-emerald-600 transition-colors">
                                {post.data.title}
                            </h3>

                            <p class="text-slate-600 text-sm line-clamp-3 mb-6 flex-grow">
                                {post.data.description}
                            </p>

                            <div class="flex items-center text-emerald-600 font-bold text-sm mt-auto">
                                اقرأ المزيد
                                <ArrowLeft className="w-4 h-4 mr-2 transition-transform group-hover:-translate-x-1" />
                            </div>
                        </div>
                    </a>
                ))
            }
        </div>

        <div class="mt-12 text-center md:hidden">
            <a
                href="/blog"
                class="inline-flex items-center gap-2 text-emerald-600 font-bold hover:text-emerald-700 transition-colors"
            >
                عرض جميع المقالات
                <ArrowLeft className="w-5 h-5" />
            </a>
        </div>
    </Container>
</section>
