---
interface Props {
  query: string;
}

const { query } = Astro.props;
const encodedQuery = encodeURIComponent(query);
---

<div
  class="w-full h-[400px] rounded-2xl overflow-hidden shadow-md border border-slate-200 bg-slate-100 relative group"
>
  <iframe
    width="100%"
    height="100%"
    frameborder="0"
    style="border:0"
    loading="lazy"
    allowfullscreen
    src={`https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=${encodedQuery}`}
    class="grayscale-[20%] group-hover:grayscale-0 transition-all duration-500"
  >
  </iframe>
  {
    /* Fallback for no API Key (using simple embed for demo if needed, but sticking to standard structure) */
  }
  {
    /* Note: In a real production environment without an API key, we might use a static map or a direct link. 
      For this implementation, we assume an API key or use the standard embed format which might require one. 
      Alternatively, we can use the 'maps?q=' format which sometimes works without a key for simple queries in iframes, 
      but 'embed/v1/place' is more robust. 
      
      Let's use the standard output=embed format which is often free/open for simple usage.
  */
  }
</div>

{
  /* 
  Re-writing the iframe src to use the standard embed output which is more commonly used for free embedding 
  without a strict API key requirement for simple display.
*/
}
<script>
  const frames = document.querySelectorAll("iframe");
  frames.forEach((frame) => {
    if (frame.src.includes("YOUR_API_KEY")) {
      // Switch to the standard embed format
      const query = frame.src.split("q=")[1];
      frame.src = `https://maps.google.com/maps?q=${query}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
    }
  });
</script>
