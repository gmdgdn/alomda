---
import Layout from "../../layouts/Layout.astro";
import { DISTRICTS } from "../../data/districts";
import { CONTENT_TEMPLATES } from "../../data/content-dictionaries";
import NearbyDistricts from "../../components/NearbyDistricts.astro";
import SeoHead from "../../components/seo/SeoHead.astro";
import { SITE_CONFIG } from "../../data/site-config";
import StickyActionBar from "../../components/StickyActionBar";
import ServiceAreaList from "../../components/services/ServiceAreaList.astro";
import {
  Phone,
  MessageCircle,
  CheckCircle,
  MapPin,
  Star,
  ShieldCheck,
  Truck,
  Clock,
  DollarSign,
} from "lucide-react";

export const prerender = true;

export async function getStaticPaths() {
  return DISTRICTS.map((district) => ({
    params: { district: district.slug },
    props: { district },
  }));
}

const { district } = Astro.props;

// 1. SELECT THE CONTENT VIBE
// Fallback to 'Family' if vibe is not found in CONTENT_TEMPLATES (though we added fallbacks)
const content = CONTENT_TEMPLATES[district.vibe] || CONTENT_TEMPLATES["Family"];

// 2. INJECT VARIABLES INTO TEXT
const formatText = (text) => text.replace(/{nameAr}/g, district.nameAr);

const heroHeadline = formatText(content.hero.headline);
const heroSubhead = formatText(content.hero.subhead);
const mapQuery = encodeURIComponent(`${district.nameAr}, Riyadh, Saudi Arabia`);

// 3. SERVICE GRID DATA (Reordered based on vibe)
const services = [
  {
    id: "acs",
    title: "ุดุฑุงุก ููููุงุช",
    desc: `ูุดุชุฑู ุฌููุน ุงูููููุงุช ูู ${district.nameAr}ุ ุณูุงุก ูุงูุช ุณุจููุช ุฃู ุดุจุงูุ ุดุบุงูุฉ ุฃู ุณูุฑุงุจ.`,
    icon: "โ๏ธ",
  },
  {
    id: "bedrooms",
    title: "ุดุฑุงุก ุบุฑู ููู",
    desc: `ูุดุชุฑู ุบุฑู ุงูููู ุงููุณุชุนููุฉ ูู ${district.nameAr} ุจุฃุนูู ุณุนุฑ. ูู ูุชุฑููุจ ูุฌุงูู.`,
    icon: "๐๏ธ",
  },
  {
    id: "kitchens",
    title: "ุดุฑุงุก ูุทุงุจุฎ",
    desc: `ูุดุชุฑู ุงููุทุงุจุฎ ุงูุฃููููููู ูุงูุฎุดุจ ูู ${district.nameAr} ูุน ุงููู ูุงูููู.`,
    icon: "๐ณ",
  },
  {
    id: "appliances",
    title: "ุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ",
    desc: `ุดุฑุงุก ุงูุซูุงุฌุงุชุ ุงูุบุณุงูุงุชุ ูุงูุฃูุฑุงู ูู ${district.nameAr} ูุงูุฏูุน ูุงุด.`,
    icon: "๐",
  },
  {
    id: "furniture",
    title: "ุงุซุงุซ ููุฒูู",
    desc: `ูุดุชุฑู ุงูููุจุ ุงููุฌุงูุณุ ูุงูุทุงููุงุช ูู ุฌููุน ุฃุญูุงุก ${district.nameAr}.`,
    icon: "๐๏ธ",
  },
  {
    id: "scrap",
    title: "ุดุฑุงุก ุณูุฑุงุจ",
    desc: `ูุดุชุฑู ุณูุฑุงุจ ุงูุญุฏูุฏ ูุงููุญุงุณ ูุงูุฃููููููู ูู ${district.nameAr} ุจุฃุณุนุงุฑ ุงูุณูู.`,
    icon: "โป๏ธ",
  },
];

// Reorder logic
let orderedServices = [...services];
if (content.servicesFocus === "Scrap & ACs") {
  const priority = ["acs", "scrap", "kitchens"];
  orderedServices.sort((a, b) => {
    const aP = priority.indexOf(a.id);
    const bP = priority.indexOf(b.id);
    return (aP === -1 ? 99 : aP) - (bP === -1 ? 99 : bP);
  });
} else if (content.servicesFocus === "Bedrooms & Kitchens") {
  const priority = ["bedrooms", "kitchens", "furniture"];
  orderedServices.sort((a, b) => {
    const aP = priority.indexOf(a.id);
    const bP = priority.indexOf(b.id);
    return (aP === -1 ? 99 : aP) - (bP === -1 ? 99 : bP);
  });
}

// FAQ Schema Data
const faqData = [
  {
    question: `ูู ุชุดุชุฑูู ุงูุงุซุงุซ ุงููุณุชุนูู ูู ${district.nameAr}ุ`,
    answer: `ูุนูุ ูุญู ูุดุชุฑู ุฌููุน ุฃููุงุน ุงูุงุซุงุซ ุงููุณุชุนูู ูู ${district.nameAr} ูุงูููุงุทู ุงููุฌุงูุฑุฉ. ูุดุชุฑู ุบุฑู ุงููููุ ุงูููููุงุชุ ุงููุทุงุจุฎุ ูุงูุฃุฌูุฒุฉ ุงูููุฑุจุงุฆูุฉ.`,
  },
  {
    question: `ููู ูุชู ุชุญุฏูุฏ ุณุนุฑ ุงูุงุซุงุซ ูู ${district.nameAr}ุ`,
    answer: `ูุชู ุชุญุฏูุฏ ุงูุณุนุฑ ุจูุงุกู ุนูู ุญุงูุฉ ุงูุงุซุงุซุ ุงูููุฏููุ ูุงูุนูุฑ. ูุฑุณู ููุฏูุจุงู ูููุนุงููุฉ ูู ${district.nameAr} ูุชูุฏูู ุนุฑุถ ุณุนุฑ ุนุงุฏู ูููุฑู.`,
  },
  {
    question: `ูู ุชููุฑูู ุฎุฏูุฉ ุงูููู ูู ${district.nameAr}ุ`,
    answer: `ูุนูุ ูููุฑ ุฎุฏูุฉ ุงููู ูุงูููู ุงููุฌุงูู ูู ${district.nameAr}. ูุฏููุง ุณูุงุฑุงุช ูุฌูุฒุฉ ูุนูุงูุฉ ูุฏุฑุจุฉ ูููู ุงูุนูุด ุฏูู ุฃู ุชูุงููู ุฅุถุงููุฉ ุนููู.`,
  },
  {
    question: `ูุชู ูููููู ุงูุญุถูุฑ ุฅูู ${district.nameAr}ุ`,
    answer: `ูุญู ูุชูุงุฌุฏูู ุนูู ูุฏุงุฑ ุงูุณุงุนุฉ. ุจูุฌุฑุฏ ุงูุงุชุตุงูุ ูููููุง ุงููุตูู ุฅููู ูู ${district.nameAr} ุฎูุงู 60 ุฏูููุฉ ุฃู ูู ุงูููุช ุงูุฐู ููุงุณุจู.`,
  },
];

const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: faqData.map((item) => ({
    "@type": "Question",
    name: item.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: item.answer,
    },
  })),
};
---

<Layout title={heroHeadline}>
  <SeoHead title={heroHeadline} description={heroSubhead} />

  {/* JSON-LD FAQ Schema */}
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

  {/* Sticky Mobile Action Bar */}
  <StickyActionBar client:load />

  {/* SECTION 1: HYPER-LOCAL HERO */}
  <section class="relative bg-emerald-900 text-white py-20 overflow-hidden">
    {/* Dynamic Background Overlay */}
    <div class="absolute inset-0 bg-black/60 z-10"></div>
    <div
      class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/arabesque.png')] opacity-10 z-0"
    >
    </div>

    <div class="relative z-20 container mx-auto px-4 text-center">
      <div
        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 backdrop-blur-md border border-white/20 mb-8 animate-fade-up"
      >
        <span class="w-2 h-2 rounded-full bg-amber-400 animate-pulse"></span>
        <span class="text-amber-300 font-bold tracking-wide"
          >๐ ูุชูุงุฌุฏูู ุงูุขู ุจุงููุฑุจ ูู {district.nameAr}</span
        >
      </div>

      <h1
        class="text-4xl md:text-6xl font-bold mb-6 leading-tight max-w-4xl mx-auto animate-fade-up [animation-delay:200ms]"
      >
        <span class="text-gradient-gold">{heroHeadline}</span>
      </h1>

      <p
        class="text-xl text-emerald-50 mb-10 max-w-2xl mx-auto leading-relaxed animate-fade-up [animation-delay:400ms]"
      >
        {heroSubhead}
      </p>

      <div
        class="flex flex-col sm:flex-row gap-4 justify-center animate-fade-up [animation-delay:600ms]"
      >
        <a
          href={`https://wa.me/${SITE_CONFIG.whatsapp}`}
          class="track-whatsapp group relative bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 text-white font-bold py-4 px-8 rounded-full text-xl flex items-center justify-center gap-3 transition-all hover:scale-105 shadow-lg shadow-emerald-500/30 overflow-hidden"
        >
          <span
            class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-shimmer"
          ></span>
          <div class="relative flex items-center gap-3">
            <div class="relative">
              <span
                class="absolute -inset-1 rounded-full bg-white/30 animate-ping"
              ></span>
              <MessageCircle className="w-6 h-6" />
            </div>
            <span>{formatText(content.hero.cta)}</span>
          </div>
        </a>
        <a
          href={`tel:${SITE_CONFIG.phone}`}
          class="track-call glass-premium text-emerald-900 hover:bg-white font-bold py-4 px-8 rounded-full text-xl flex items-center justify-center gap-2 transition-all hover:scale-105"
        >
          <Phone className="w-6 h-6" />
          <span>ุงุชุตู ุงูุขู</span>
        </a>
      </div>
    </div>
  </section>

  {/* SECTION 2: VALUE PROPOSITION (Why Us?) */}
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12 text-slate-800">
        {formatText(content.valueProp.title)}
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {
          content.valueProp.points.map((point, index) => (
            <div class="bg-slate-50 p-6 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition hover:-translate-y-1">
              <div class="text-emerald-600 mb-4 bg-emerald-100 w-12 h-12 rounded-full flex items-center justify-center">
                {index === 0 ? (
                  <DollarSign className="w-6 h-6" />
                ) : index === 1 ? (
                  <ShieldCheck className="w-6 h-6" />
                ) : index === 2 ? (
                  <Truck className="w-6 h-6" />
                ) : (
                  <Clock className="w-6 h-6" />
                )}
              </div>
              <p class="text-lg font-medium text-slate-700 leading-relaxed">
                {point}
              </p>
            </div>
          ))
        }
      </div>
    </div>
  </section>

  {/* SECTION 3: SERVICES LIST (Compact) */}
  <div class="container mx-auto px-4 py-8">
    <h2 class="text-2xl font-bold mb-6 text-slate-900">
      ุฎุฏูุงุชูุง ูู {district.nameAr}
    </h2>
    <ServiceAreaList district={district.nameAr} />
  </div>

  {/* SECTION 4: HIGHLIGHTED MAP & LOCATION PROOF */}
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4 grid lg:grid-cols-2 gap-12 items-center">
      <div>
        <h2 class="text-3xl font-bold mb-6 text-slate-900">
          ูุตูู ูู {district.nameAr} ุฎูุงู 60 ุฏูููุฉ
        </h2>
        <p class="text-lg text-slate-600 mb-8 leading-relaxed">
          ุดุงุญูุงุชูุง ููุฒุนุฉ ูู {
            district.region === "North"
              ? "ุดูุงู ุงูุฑูุงุถ"
              : district.region === "South"
                ? "ุฌููุจ ุงูุฑูุงุถ"
                : district.region === "East"
                  ? "ุดุฑู ุงูุฑูุงุถ"
                  : district.region === "West"
                    ? "ุบุฑุจ ุงูุฑูุงุถ"
                    : "ูุณุท ุงูุฑูุงุถ"
          } ูุจุงููุฑุจ ูู {district.landmarks[0]}. ูุง ุฏุงุนู ููุงูุชุธุงุฑุ ุจูุฌุฑุฏ ุงูุงุชุตุงู
          ูุชุญุฑู ุงูููุฏูุจ ุงูุฃูุฑุจ ููููุนู ูู {district.nameAr}.
        </p>
        <ul class="space-y-4">
          <li class="flex items-center gap-3">
            <CheckCircle className="w-6 h-6 text-green-500 shrink-0" />
            <span class="text-slate-700 font-medium"
              >ุณุฑุนุฉ ูู ุงููุตูู ูุงููุนุงููุฉ</span
            >
          </li>
          <li class="flex items-center gap-3">
            <CheckCircle className="w-6 h-6 text-green-500 shrink-0" />
            <span class="text-slate-700 font-medium"
              >ูุนุฑูุฉ ุชุงูุฉ ุจูุฏุงุฎู ููุฎุงุฑุฌ {district.nameAr}</span
            >
          </li>
          <li class="flex items-center gap-3">
            <CheckCircle className="w-6 h-6 text-green-500 shrink-0" />
            <span class="text-slate-700 font-medium"
              >ููู ููุฑู ุฏูู ุฅุฒุนุงุฌ ุงูุฌูุฑุงู</span
            >
          </li>
        </ul>
      </div>
      <div
        class="h-[400px] w-full rounded-2xl overflow-hidden shadow-xl border-4 border-slate-100 relative group"
      >
        {/* Highlighted Map Overlay */}
        <div
          class="absolute top-4 right-4 bg-white/95 backdrop-blur px-4 py-2 rounded-lg shadow-md z-10 text-sm font-bold text-emerald-800 flex items-center gap-2"
        >
          <MapPin className="w-4 h-4" />
          ุชุบุทูุฉ ุญู {district.nameAr}
        </div>
        <iframe
          width="100%"
          height="100%"
          frameborder="0"
          style="border:0"
          loading="lazy"
          src={`https://www.google.com/maps?q=${mapQuery}&output=embed`}
          allowfullscreen
          class="grayscale group-hover:grayscale-0 transition duration-700"
        >
        </iframe>
      </div>
    </div>
  </section>

  {/* SECTION 5: SOCIAL PROOF (Localized) */}
  <section class="py-16 bg-emerald-50">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl font-bold mb-12 text-slate-900">
        ุขุฑุงุก ุฌูุฑุงูู ูู {district.nameAr}
      </h2>
      <div
        class="max-w-3xl mx-auto bg-white p-8 md:p-12 rounded-2xl shadow-lg relative"
      >
        <div
          class="text-6xl text-emerald-100 absolute top-4 right-8 font-serif"
        >
          โ
        </div>
        <div class="flex justify-center mb-6">
          {
            [1, 2, 3, 4, 5].map(() => (
              <Star className="w-6 h-6 text-amber-400 fill-current" />
            ))
          }
        </div>
        <p
          class="text-xl md:text-2xl text-slate-700 italic mb-8 leading-relaxed relative z-10"
        >
          "{formatText(content.review)}"
        </p>
        <div class="font-bold text-emerald-800 text-lg">
          โ {formatText(content.reviewer)}
        </div>
      </div>
    </div>
  </section>

  {/* SECTION 6: GEO PRICING TABLE (For Snippets) */}
  <section class="py-16 bg-white">
    <div class="container mx-auto px-4 max-w-4xl">
      <h2
        class="text-2xl md:text-3xl font-bold mb-6 text-center text-slate-900"
      >
        ูุชูุณุท ุฃุณุนุงุฑ ุดุฑุงุก ุงูุงุซุงุซ ูู {district.nameAr}
      </h2>
      <p class="text-center text-slate-500 mb-10">
        ูุฐู ุงูุฃุณุนุงุฑ ุชูุฏูุฑูุฉ ูุชุนุชูุฏ ุนูู ูุธุงูุฉ ุงูุงุซุงุซ ูุงูููุฏูู.
      </p>

      <div class="overflow-x-auto rounded-xl border border-slate-200 shadow-sm">
        <table class="w-full text-right bg-white">
          <thead class="bg-slate-50 text-slate-700">
            <tr>
              <th class="p-4 border-b border-slate-200 font-bold">ุงูููุน</th>
              <th class="p-4 border-b border-slate-200 font-bold"
                >ุงูุณุนุฑ ุงูุชูุฏูุฑู</th
              >
              <th class="p-4 border-b border-slate-200 font-bold">ููุงุญุธุงุช</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-100">
            <tr class="hover:bg-slate-50 transition">
              <td class="p-4 text-slate-700 font-medium">ูููู ุณุจููุช (ูุธูู)</td>
              <td class="p-4 text-emerald-600 font-bold" dir="ltr"
                >500 - 1500 SAR</td
              >
              <td class="p-4 text-slate-500 text-sm">ุญุณุจ ุงูุทู ูุงููุงุฑูุฉ</td>
            </tr>
            <tr class="hover:bg-slate-50 transition">
              <td class="p-4 text-slate-700 font-medium">ุบุฑูุฉ ููู ูุงููุฉ</td>
              <td class="p-4 text-emerald-600 font-bold" dir="ltr"
                >300 - 2000 SAR</td
              >
              <td class="p-4 text-slate-500 text-sm">ุงูููุงุ ูุทููุ ุฃู ุตููู</td>
            </tr>
            <tr class="hover:bg-slate-50 transition">
              <td class="p-4 text-slate-700 font-medium"
                >ุณูุฑุงุจ (ุญุฏูุฏ/ุงูููููู)</td
              >
              <td class="p-4 text-emerald-600 font-bold">ุญุณุจ ุงููุฒู</td>
              <td class="p-4 text-slate-500 text-sm">ููู ููุฑู</td>
            </tr>
            <tr class="hover:bg-slate-50 transition">
              <td class="p-4 text-slate-700 font-medium">ูุฌูุณ ุนุฑุจู / ููุจ</td>
              <td class="p-4 text-emerald-600 font-bold" dir="ltr"
                >200 - 1000 SAR</td
              >
              <td class="p-4 text-slate-500 text-sm">ุญุณุจ ุงููุธุงูุฉ ูุนุฏุฏ ุงููุทุน</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  {/* SECTION 7: FAQ SCHEMA */}
  <section class="py-16 bg-slate-50">
    <div class="container mx-auto px-4 max-w-3xl">
      <h2 class="text-3xl font-bold mb-10 text-center text-slate-900">
        ุฃุณุฆูุฉ ุดุงุฆุนุฉ ูู ุณูุงู {district.nameAr}
      </h2>
      <div class="space-y-4">
        {
          faqData.map((item) => (
            <details class="group bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
              <summary class="flex items-center justify-between p-6 cursor-pointer list-none">
                <span class="font-bold text-slate-800 text-lg">
                  {item.question}
                </span>
                <span class="transition group-open:rotate-180">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-6 h-6 text-emerald-500"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M19.5 8.25l-7.5 7.5-7.5-7.5"
                    />
                  </svg>
                </span>
              </summary>
              <div class="px-6 pb-6 text-slate-600 leading-relaxed border-t border-slate-100 pt-4">
                {item.answer}
              </div>
            </details>
          ))
        }
      </div>
    </div>
  </section>

  <NearbyDistricts
    currentRegion={district.region}
    currentDistrictSlug={district.slug}
  />
</Layout>
