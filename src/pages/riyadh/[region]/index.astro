---
import {
    Quote,
    Phone,
    Info,
    MapPin,
    ArrowLeft,
    CheckCircle,
    Star,
    ChevronDown,
} from "lucide-react";
import { RIYADH_DISTRICTS } from "../../../data/districts";
import Layout from "../../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { SERVICE_TEMPLATES } from "../../../data/service-content";
import Container from "../../../components/ui/Container.astro";
import { SITE_CONFIG } from "../../../data/site-config";
import TrustGrid from "../../../components/home/TrustGrid.astro";
import HowItWorks from "../../../components/home/HowItWorks.astro";
import {
    Bed,
    AirVent,
    ChefHat,
    Refrigerator,
    Armchair,
    Truck,
    Briefcase,
    Home,
} from "lucide-react";

// Import Region-Based Backgrounds
import LocationIntelligence from "../../../components/ui/LocationIntelligence.astro";
import DynamicPricingTable from "../../../components/ui/DynamicPricingTable.astro";

import northImg from "../../../assets/images/backgrounds/used-furniture-north-riyadh-alomda-sa.jpeg";
import southImg from "../../../assets/images/backgrounds/used-furniture-south -riyadh-alomda-sa.jpg";
import eastImg from "../../../assets/images/backgrounds/used-furniture-east-riyadh-alomda-sa.jpg";
import westImg from "../../../assets/images/backgrounds/used-furniture-west-riyadh-alomda-sa.jpg";
import centralImg from "../../../assets/images/backgrounds/used-furniture-riyadh-alomda-sa.webp";

export async function getStaticPaths() {
    const regions = [
        {
            slug: "north-riyadh",
            nameAr: "شمال الرياض",
            key: "North",
            description:
                "شمال الرياض هو واجهة العاصمة الحديثة، ويضم أرقى الأحياء والفلل الفاخرة. نحن متخصصون في شراء الاثاث الراقي والمودرن من أحياء الشمال مثل الملقا، الياسمين، والنخيل.",
            heroImage: northImg,
        },
        {
            slug: "south-riyadh",
            nameAr: "جنوب الرياض",
            key: "South",
            description:
                "جنوب الرياض يتميز بالحركة التجارية النشطة والأسواق العريقة. نشتري جميع أنواع الاثاث، السكراب، والمكيفات من أحياء الجنوب مثل العزيزية والشفاء.",
            heroImage: southImg,
        },
        {
            slug: "east-riyadh",
            nameAr: "شرق الرياض",
            key: "East",
            description:
                "شرق الرياض يشهد توسعاً عمرانياً كبيراً. نقدم خدماتنا لجميع سكان الشرق في اليرموك، المونسية، والنسيم، ونضمن سرعة الوصول والتقييم العادل.",
            heroImage: eastImg,
        },
        {
            slug: "west-riyadh",
            nameAr: "غرب الرياض",
            key: "West",
            description:
                "غرب الرياض يجمع بين الأصالة والحداثة. نصل إلى لبن، السويدي، والبديعة في أسرع وقت لشراء اثاثكم المستعمل بأفضل الأسعار.",
            heroImage: westImg,
        },
        {
            slug: "central-riyadh",
            nameAr: "وسط الرياض",
            key: "Central",
            description:
                "وسط الرياض هو القلب النابض للعاصمة. نخدم أحياء العليا، الملز، والمربع ونشتري الاثاث المكتبي والمنزلي.",
            heroImage: centralImg,
        },
    ];

    return regions.map((region) => ({
        params: { region: region.slug },
        props: { region },
    }));
}

const { region } = Astro.props;

// Filter districts for this region
const regionDistricts = RIYADH_DISTRICTS.filter((d) => d.region === region.key);

// Map service icons manually since they are not in SERVICE_TEMPLATES
const serviceIcons: Record<string, any> = {
    "used-bedrooms": Bed,
    "used-acs": AirVent,
    "used-kitchens": ChefHat,
    "used-appliances": Refrigerator,
    "used-majlis": Armchair,
    "used-office-furniture": Briefcase,
    "villa-furniture": Home,
    "general-furniture": Truck, // Fallback
    "furniture-moving": Truck,
    "used-kitchen-equipment": ChefHat,
};

const servicesList = Object.values(SERVICE_TEMPLATES).map((service) => ({
    ...service,
    icon: serviceIcons[service.slug] || Truck,
}));

// Region specific content
const reviews = [
    {
        name: "أبو محمد",
        location: `عميل في ${region.nameAr}`,
        text: "تعامل راقي وسرعة في الإنجاز. المندوب وصل في الموعد وتم الاتفاق على سعر ممتاز.",
        rating: 5,
    },
    {
        name: "أم عبدالله",
        location: `عميلة في ${region.nameAr}`,
        text: "باعوا لي غرفة النوم والمكيفات بسعر ما توقعته. فكوا الاثاث ونظفوا المكان بعدهم.",
        rating: 5,
    },
    {
        name: "سعد القحطاني",
        location: `عميل في ${region.nameAr}`,
        text: "أفضل شركة تعاملت معها في الرياض. مصداقية وأمانة.",
        rating: 5,
    },
];

const faqs = [
    {
        question: `هل تشترون جميع أنواع الاثاث في ${region.nameAr}؟`,
        answer: "نعم، نشتري غرف النوم، المكيفات، المطابخ، المجالس، والأجهزة الكهربائية بجميع حالاتها.",
    },
    {
        question: `كم يستغرق الوصول إلى ${region.nameAr}؟`,
        answer: `لدينا مندوبين متواجدين بشكل دائم في ${region.nameAr}، ونصلك عادة خلال 30-60 دقيقة.`,
    },
    {
        question: "هل النقل والفك مجاني؟",
        answer: "نعم، نتحمل كافة تكاليف الفك والنقل والتحميل. لن تدفع ريالاً واحداً.",
    },
    {
        question: "كيف يتم دفع المبلغ؟",
        answer: "ندفع المبلغ كاملاً كاش أو تحويل بنكي فوري قبل البدء في نقل الاثاث.",
    },
];

const title = `شراء اثاث مستعمل ${region.nameAr} | نغطي جميع الأحياء | ${SITE_CONFIG.nameAr}`;
const description = `نشتري الاثاث المستعمل في ${region.nameAr} بأعلى الأسعار. نغطي ${regionDistricts
    .map((d) => d.nameAr)
    .join("، ")} وجميع الأحياء. خدمة سريعة، دفع كاش فوري، ونقل مجاني.`;

// Schema.org
const schema = {
    "@context": "https://schema.org",
    "@type": "Service",
    name: `شراء اثاث مستعمل في ${region.nameAr}`,
    provider: {
        "@type": "LocalBusiness",
        name: SITE_CONFIG.nameAr,
        telephone: SITE_CONFIG.phone,
        image: SITE_CONFIG.ogImage,
    },
    areaServed: {
        "@type": "Place",
        name: region.nameAr,
    },
    description: description,
    serviceType: "Buying Used Furniture",
};

const breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
        {
            "@type": "ListItem",
            position: 1,
            name: "الرئيسية",
            item: SITE_CONFIG.domain,
        },
        {
            "@type": "ListItem",
            position: 2,
            name: "مناطق الخدمة",
            item: `${SITE_CONFIG.domain}/riyadh`,
        },
        {
            "@type": "ListItem",
            position: 3,
            name: region.nameAr,
            item: `${SITE_CONFIG.domain}/${region.slug}`,
        },
    ],
};
---

<Layout title={title} description={description}>
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    <script
        type="application/ld+json"
        set:html={JSON.stringify(breadcrumbSchema)}
    />

    {/* Hero Section */}
    <section
        class="relative min-h-[60vh] flex items-center justify-center overflow-hidden bg-slate-900"
    >
        <div class="absolute inset-0 z-0">
            <Image
                src={region.heroImage}
                alt={`شراء اثاث مستعمل في ${region.nameAr}`}
                class="w-full h-full object-cover opacity-40"
                format="webp"
            />
            <div
                class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/60 to-transparent"
            >
            </div>
        </div>

        <Container className="relative z-10 text-center pt-20">
            <div
                class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/20 border border-emerald-500/30 text-emerald-300 mb-6 backdrop-blur-sm animate-fade-in-down"
            >
                <MapPin className="w-4 h-4" />
                <span class="text-sm font-bold"
                    >تغطية شاملة لـ {region.nameAr}</span
                >
            </div>

            <h1
                class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 text-white leading-tight animate-fade-in-up"
            >
                شراء اثاث مستعمل <br />
                <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-400"
                    >{region.nameAr}</span
                >
            </h1>

            <p
                class="text-xl text-slate-200 max-w-3xl mx-auto mb-10 leading-relaxed animate-fade-in-up delay-100"
            >
                {region.description}
            </p>

            <div
                class="flex flex-col sm:flex-row gap-4 justify-center animate-fade-in-up delay-200"
            >
                <a
                    href={`tel:${SITE_CONFIG.phone}`}
                    class="flex items-center justify-center gap-2 px-8 py-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-emerald-600/30 hover:scale-105"
                >
                    <Phone className="w-5 h-5" />
                    <span>اتصل الآن: {SITE_CONFIG.phone}</span>
                </a>
                <a
                    href="#districts"
                    class="flex items-center justify-center gap-2 px-8 py-4 bg-white/10 hover:bg-white/20 text-white rounded-xl font-bold transition-all backdrop-blur-sm hover:scale-105"
                >
                    <span>تصفح {regionDistricts.length} حي</span>
                </a>
            </div>
        </Container>
    </section>

    {/* Trust Grid */}
    <TrustGrid />

    {/* Intro / About Region */}
    <section class="py-20 bg-slate-50">
        <Container>
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div class="space-y-6">
                    <h2 class="text-3xl font-bold text-slate-900">
                        لماذا نحن الخيار الأول في <span
                            class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-800 to-teal-600"
                            >{region.nameAr}</span
                        >؟
                    </h2>
                    <p class="text-lg text-slate-600 leading-relaxed">
                        نحن نفهم احتياجات سكان {region.nameAr} جيداً. سواء كنت تسكن
                        في فيلا أو شقة، لدينا فريق متخصص ومعدات مناسبة لنقل الاثاث
                        دون إحداث أي أضرار. نغطي جميع الأحياء ونصلك أينما كنت.
                    </p>
                    <ul class="space-y-4">
                        <li class="flex items-center gap-3">
                            <CheckCircle className="w-6 h-6 text-emerald-500" />
                            <span class="text-slate-700 font-medium"
                                >سرعة الوصول لجميع أحياء {region.nameAr} (خلال 60
                                دقيقة)</span
                            >
                        </li>
                        <li class="flex items-center gap-3">
                            <CheckCircle className="w-6 h-6 text-emerald-500" />
                            <span class="text-slate-700 font-medium"
                                >أسعار تنافسية وعادلة للسوق الحالي</span
                            >
                        </li>
                        <li class="flex items-center gap-3">
                            <CheckCircle className="w-6 h-6 text-emerald-500" />
                            <span class="text-slate-700 font-medium"
                                >دفع فوري كاش قبل التحميل</span
                            >
                        </li>
                    </ul>
                </div>
                <div class="relative">
                    <div
                        class="absolute inset-0 bg-emerald-600 rounded-3xl rotate-3 opacity-10"
                    >
                    </div>
                    <Image
                        src={region.heroImage}
                        alt="نقل عفش بالرياض"
                        class="relative rounded-3xl shadow-xl w-full h-auto object-cover"
                    />
                </div>
            </div>
        </Container>
    </section>

    {/* Services Section */}
    <section class="py-20 bg-white">
        <Container>
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">
                    خدماتنا في <span
                        class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-800 to-teal-600"
                        >{region.nameAr}</span
                    >
                </h2>
                <p class="text-slate-600">
                    نشتري كافة أنواع الاثاث المنزلي والمكتبي بأفضل الأسعار
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {
                    servicesList.map((service) => (
                        <a
                            href={`/services/${service.slug}`}
                            class="flex items-start gap-4 p-6 rounded-2xl bg-white hover:bg-emerald-50 hover:shadow-xl hover:-translate-y-1 transition-all group border border-slate-100 relative overflow-hidden"
                        >
                            <div class="absolute top-0 right-0 w-20 h-20 bg-emerald-100 rounded-bl-full -mr-10 -mt-10 opacity-50 group-hover:scale-150 transition-transform duration-500" />
                            <div class="w-14 h-14 bg-white rounded-xl flex items-center justify-center shrink-0 shadow-sm group-hover:bg-white transition-colors relative z-10 border border-slate-100">
                                <service.icon className="w-7 h-7 text-slate-400 group-hover:text-emerald-600 transition-colors" />
                            </div>
                            <div class="relative z-10">
                                <h3 class="font-bold text-slate-900 group-hover:text-emerald-700 transition-colors text-lg mb-1">
                                    {service.titleAr}
                                </h3>
                                <p class="text-sm text-slate-500 line-clamp-2">
                                    {service.hero.sub}
                                </p>
                            </div>
                        </a>
                    ))
                }
            </div>
        </Container>
    </section>

    {/* Region Map (Moved before Districts) */}
    <section class="py-12 bg-slate-50 border-y border-slate-200">
        <Container>
            <div class="max-w-4xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">
                        موقعنا في {region.nameAr}
                    </h2>
                    <p class="text-slate-600">
                        نغطي جميع أحياء {region.nameAr} ونصلك أينما كنت
                    </p>
                </div>
                <LocationIntelligence
                    query={`${region.nameAr}, Riyadh, Saudi Arabia`}
                    districtName={region.nameAr}
                    landmark="جميع الأحياء"
                />
            </div>
        </Container>
    </section>

    {/* Districts List */}
    <section id="districts" class="py-20 bg-white">
        <Container>
            <div class="text-center mb-16">
                <span
                    class="text-emerald-600 font-bold tracking-wider uppercase mb-2 block"
                    >تغطية شاملة</span
                >
                <h2 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">
                    أحياء <span
                        class="bg-clip-text text-transparent bg-gradient-to-r from-emerald-800 to-teal-600"
                        >{region.nameAr}</span
                    > التي نخدمها
                </h2>
                <p class="text-slate-600 max-w-2xl mx-auto">
                    فريقنا متواجد في جميع هذه الأحياء لخدمتكم على مدار الساعة.
                    اختر حيك لتفاصيل أكثر.
                </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {
                    regionDistricts.map((district) => (
                        <a
                            href={`/riyadh/${Astro.params.region}/${district.slug}`}
                            class="group bg-slate-50 p-6 rounded-2xl border border-slate-100 hover:border-emerald-500/30 hover:shadow-lg hover:shadow-emerald-500/5 transition-all duration-300 flex items-center justify-between"
                        >
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center text-emerald-600 shadow-sm group-hover:scale-110 transition-transform">
                                    <MapPin className="w-6 h-6" />
                                </div>
                                <div>
                                    <h3 class="font-bold text-lg text-slate-900 group-hover:text-emerald-700 transition-colors">
                                        شراء اثاث مستعمل في {district.nameAr}
                                    </h3>
                                    <div class="flex items-center gap-2 mt-1">
                                        <span class="text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 font-medium">
                                            {district.vibe === "Luxury"
                                                ? "حي راقي"
                                                : "حي سكني"}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <ArrowLeft className="w-5 h-5 text-slate-300 group-hover:text-emerald-500 transition-colors transform group-hover:-translate-x-1" />
                        </a>
                    ))
                }
            </div>
        </Container>
    </section>
    <section class="py-16 bg-white">
        <Container>
            <div class="text-center mb-12">
                <h2
                    class="text-3xl md:text-4xl font-bold text-emerald-950 mb-4"
                >
                    أسعار شراء الاثاث في {region.nameAr}
                </h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    نقدم أفضل الأسعار في {region.nameAr} مع ضمان الدفع الفوري.
                </p>
            </div>
            <DynamicPricingTable
                vibe={region.key === "North" ? "Luxury" : "Standard"}
            />
        </Container>
    </section>

    {/* Reviews Section */}
    <section class="py-20 bg-white">
        <Container>
            <div class="text-center mb-16">
                <h2 class="text-3xl font-bold text-slate-900 mb-4">
                    آراء عملاء {region.nameAr}
                </h2>
                <p class="text-slate-600">
                    نفخر بثقة عملائنا ونسعى دائماً لرضاهم
                </p>
            </div>
            <div class="grid md:grid-cols-3 gap-8">
                {
                    reviews.map((review) => (
                        <div class="bg-slate-50 p-8 rounded-3xl relative hover:shadow-md transition-shadow">
                            <Quote className="w-10 h-10 text-emerald-100 absolute top-6 left-6" />
                            <div class="flex gap-1 mb-4">
                                {[...Array(review.rating)].map(() => (
                                    <Star className="w-5 h-5 text-amber-400 fill-amber-400" />
                                ))}
                            </div>
                            <p class="text-slate-700 mb-6 leading-relaxed relative z-10">
                                "{review.text}"
                            </p>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-emerald-200 flex items-center justify-center text-emerald-700 font-bold">
                                    {review.name.charAt(0)}
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-900">
                                        {review.name}
                                    </h4>
                                    <span class="text-xs text-slate-500">
                                        {review.location}
                                    </span>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </Container>
    </section>

    {/* FAQ Section */}
    <section class="py-20 bg-slate-50">
        <Container>
            <div class="max-w-3xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-slate-900 mb-4">
                        أسئلة شائعة عن خدماتنا في {region.nameAr}
                    </h2>
                </div>
                <div class="space-y-4">
                    {
                        faqs.map((faq) => (
                            <details class="group bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                                <summary class="flex items-center justify-between p-6 cursor-pointer list-none">
                                    <h3 class="font-bold text-slate-900 text-lg">
                                        {faq.question}
                                    </h3>
                                    <ChevronDown className="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform" />
                                </summary>
                                <div class="px-6 pb-6 text-slate-600 leading-relaxed border-t border-slate-50 pt-4">
                                    {faq.answer}
                                </div>
                            </details>
                        ))
                    }
                </div>
            </div>
        </Container>
    </section>

    {/* Final CTA */}
    <section
        class="py-24 relative overflow-hidden bg-gradient-to-br from-slate-900 via-emerald-950 to-slate-900"
    >
        <div
            class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"
        >
        </div>
        <div
            class="absolute -right-20 -top-20 w-96 h-96 bg-emerald-500/20 rounded-full blur-3xl animate-pulse"
        >
        </div>
        <div
            class="absolute -left-20 -bottom-20 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl animate-pulse delay-700"
        >
        </div>

        <Container className="relative z-10 text-center">
            <h2
                class="text-3xl md:text-5xl font-bold text-white mb-8 leading-tight"
            >
                جاهز لبيع اثاثك في <span
                    class="text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-400"
                    >{region.nameAr}</span
                >؟
            </h2>
            <p
                class="text-xl text-slate-300 mb-12 max-w-2xl mx-auto leading-relaxed"
            >
                لا تتردد في التواصل معنا. نحن نضمن لك أفضل سعر وأسرع خدمة في
                المنطقة.
            </p>
            <div class="flex flex-col sm:flex-row gap-6 justify-center">
                <a
                    href={`https://wa.me/${SITE_CONFIG.whatsapp}`}
                    class="group flex items-center justify-center gap-3 px-8 py-5 bg-[#25D366] hover:bg-[#20bd5a] text-white rounded-xl font-bold text-lg transition-all shadow-lg shadow-emerald-900/20 hover:shadow-emerald-500/30 hover:-translate-y-1"
                >
                    <svg
                        class="w-6 h-6 group-hover:animate-bounce"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                        aria-hidden="true"
                        ><path
                            d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"
                        ></path></svg
                    >
                    <span>تواصل واتساب</span>
                </a>
                <a
                    href={`tel:${SITE_CONFIG.phone}`}
                    class="flex items-center justify-center gap-3 px-8 py-5 bg-white/10 text-white rounded-xl font-bold text-lg transition-all shadow-lg hover:shadow-xl hover:bg-white hover:text-slate-900 hover:-translate-y-1 backdrop-blur-sm border border-white/20"
                >
                    <Phone className="w-6 h-6" />
                    <span>اتصال هاتفي</span>
                </a>
            </div>
        </Container>
    </section>
</Layout>
